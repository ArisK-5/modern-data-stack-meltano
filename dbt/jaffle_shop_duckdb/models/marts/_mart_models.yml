version: 2

models:
  - name: mart_product_purchases
    description: |
      Joined view of purchases with product attributes. Useful for product-level
      analytics such as revenue, conversion and return rates by product.
    columns:
      - name: purchase_id
        description: "Primary purchase identifier (from `stg_purchases.purchase_id`)."
        tests: [not_null, unique]

      - name: user_id
        description: "User identifier from the purchases row."
        tests: [not_null]

      - name: product_id
        description: "Product identifier from the purchases row."
        tests: [not_null]

      - name: brand
        description: "Product brand from the joined products staging model."

      - name: model
        description: "Product model name/sku from the products staging model."

      - name: price_euros
        description: "Product price as supplied by the source; currency indicated in the column name."

      - name: is_successful_purchase
        description: "Boolean flag derived from presence of `purchased_at` in the source."

      - name: is_returned_purchase
        description: "Boolean flag indicating whether the purchase was returned."

      - name: added_to_cart_at
        description: "Timestamp when item was added to cart."

      - name: created_at
        description: "Purchase row creation timestamp."

      - name: purchased_at
        description: "Timestamp when purchase occurred (may be NULL)."

      - name: returned_at
        description: "Timestamp when the purchase was returned (may be NULL)."

      - name: updated_at
        description: "Row update timestamp from the source."

  - name: mart_user_purchases
    description: |
      Purchase events joined with user attributes. Useful for user-centric
      analyses such as conversion rates by geography or cohorts by user traits.
    columns:
      - name: purchase_id
        description: "Primary purchase identifier (from `stg_purchases.purchase_id`)."
        tests: [not_null, unique]

      - name: product_id
        description: "Product identifier associated with the purchase."
        tests: [not_null]

      - name: user_id
        description: "User identifier (from `stg_users.user_id`)."
        tests: [not_null]

      - name: first_name
        description: "User first/given name from the users staging model."

      - name: residence_state
        description: "State extracted from the users' address JSON; useful for simple geo-aggregations."

      - name: is_successful_purchase
        description: "Boolean flag whether the purchase completed."

      - name: is_returned_purchase
        description: "Boolean flag whether the purchase was returned."

      - name: purchased_at
        description: "Timestamp of purchase event (may be NULL for non-purchased events)."

      - name: returned_at
        description: "Timestamp of return event (may be NULL)."

  - name: mart_users
    description: |
      Canonical users dimension surfaced from `stg_users`. Keep PII handling or
      obfuscation outside of this sample project if you intend to use production data.
    columns:
      - name: user_id
        description: "Primary user identifier (renamed from source `id`)."
        tests: [not_null, unique]

      - name: title
        description: "Honorific/title as supplied by the source."

      - name: first_name
        description: "User first/given name."

      - name: nationality
        description: "User nationality code or string."

      - name: residence_state
        description: "State extracted from the address JSON."

      - name: occupation
        description: "User occupation as supplied by the source."

      - name: academic_degree
        description: "Academic degree reported by the user."

      - name: preferred_language
        description: "User's preferred language."

      - name: email
        description: "Contact email; treat as PII if this is real data."
        tests: [not_null]

      - name: age
        description: "Numeric age attribute from the source."

      - name: created_at
        description: "Record creation timestamp."

      - name: updated_at
        description: "Record update timestamp."
